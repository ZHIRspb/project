# CVE-2021-45232

### Материалы:

* [https://www.opencve.io/cve/CVE-2021-45232](https://www.opencve.io/cve/CVE-2021-45232)
* [https://nvd.nist.gov/vuln/detail/CVE-2021-45232](https://nvd.nist.gov/vuln/detail/CVE-2021-45232)

В Apache APISIX Dashboard до версии 2.10.1, API Manager использует два фреймворка и представляет фреймворк `droplet` на основе фреймворка `gin`, все API и промежуточное ПО аутентификации разработаны на основе фреймворка `droplet`, но некоторые API напрямую используют интерфейс фреймворка `gin`, обходя аутентификацию.

### Эксплуатация уязвимости

> Контейнер с уязвимой средой находится в директории /home/user/Hackathon/vulhub-master/apisix/CVE-2021-45232

Для запуска уязвимой среды выполните команду:

```
docker compose up -d
```

После запуска по адресу http://ваш-ip:9000 будет доступна страница входа в Apache APISIX Dashboard

<figure><img src="../../.gitbook/assets/cve-2021-45232(1).png" alt=""><figcaption></figcaption></figure>

/apisix/admin/migrate/export и /apisix/admin/migrate/import - это 2 неаутентифицированных API, предоставляемых Apache APISIX Dashboard, которые используются для экспорта и импорта конфигурации для Apache APISIX. Таким образом, мы можем просто импортировать конфигурацию с помощью злого маршрутизатора, который содержит пользовательский LUA-скрипт.

Замечено, что последние 4 байта - это контрольная сумма CRC этого файла, поэтому лучше использовать скрипт для создания и отправки запроса, например, [этот](https://github.com/wuppp/cve-2021-45232-exp/blob/main/apisix\_dashboard\_rce.py).

<figure><img src="../../.gitbook/assets/cve-2021-45232(2).png" alt=""><figcaption></figcaption></figure>

После добавления злого маршрутизатора необходимо отправить запрос в Apache APISIX  для запуска LUA-скрипта.

В данной среде Apache APISIX прослушивает порт 9080.

При обращении к созданной странице и добавлении заголовка "CMD" в запрос, можно выполнять произвольные команды

<figure><img src="../../.gitbook/assets/cve-2021-45232(3).png" alt=""><figcaption></figcaption></figure>

В Wazuh (https://ваш-ip/app/wazuh) мы можем увидеть соответствующие алерты от IDS Suricata о выводе содержимого файла /etc/passwd и о выводе результата команды "id"

<figure><img src="../../.gitbook/assets/cve-2021-45232(4).png" alt=""><figcaption></figcaption></figure>

