# CVE-2020-11651

Уязвимость была обнаружена в SaltStack Salt  в версиях до 2019.2.4 и  с 3000 до 3000.2. Класс ClearFuncs процесса salt-master неправильно проверяет вызовы методов. Это позволяет удаленному пользователю получить доступ к некоторым методам без аутентификации. Эти методы можно использовать для получения пользовательских токенов или запуска произвольных команд.

### Эксплуатация уязвимости

Для запуска уязвимой среды выполните команду:&#x20;

```
docker compose up -d 
```

Используя этот [эскплоит](https://github.com/dozernz/cve-2020-11651/blob/master/CVE-2020-11651.py), вы можете получить ключи всех пользователей. Используя этот ключ, вы можете выполнять некоторые фоновые функции с помощью привилегий суперпользователя, такие как выдача задач.

> Перед эксплуатацией вам нужно установить pip3 и библиотеку salt на атакующей машине с помощью команды `pip3 install salt`

Выполните команду `python3 CVE-2020-11651.py 10.10.11.130 master "touch /tmp/success"`  для эксплуатации уязвимости

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

После её выполнения на целевой машине был создан файл /tmp/success

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

В Wazuh (https://ваш-ip/app/wazuh) мы можем увидеть соответствующие алерты от IDS Suricata об эксплуатации данной уязвимости.

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>
